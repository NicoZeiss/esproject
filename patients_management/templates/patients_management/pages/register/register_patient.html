{% extends 'patients_management/layouts/main_layout.html' %}

{% block content %}
    <form method="POST">
        {% csrf_token %}
        {{ form.as_p }}
        <p>
            <label for="address-autocomplete">Adresse</label>
            <select name="address-autocomplete" id="address-autocomplete" style="width: 100%;"></select>
        </p>
        <button type="submit">Submit</button>
    </form>

    <a href="{% url 'register_doctor' %}">Je suis m√©decin</a>
    {% include 'patients_management/components/have_account_button.html' %}

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#address-autocomplete').select2({
                placeholder: 'Votre adresse...',
                ajax: {
                    url: '{% url "address_autocomplete" %}',
                    dataType: 'json',
                    delay: 250,
                    data: function (params) {
                        return {
                            q: params.term // search term
                        };
                    },
                    processResults: function (data) {
                        return {
                            results: data.results
                        };
                    },
                    cache: true
                }
            });

            $('#address-autocomplete').on('select2:select', function (e) {
                var data = e.params.data;
                $('#id_street').val(data['street']);
                $('#id_zip_code').val(data['zip_code']);
                $('#id_city').val(data['city']);
            });
        });
    </script>
{% endblock %}